const mongoose = require('mongoose');
const bcrypt = require('bcryptjs');

const currentDate = new Date();

const modelUsers = new mongoose.Schema({
    username: {
        type: String,
        required: true,
    },
    email: {
        type: String,
        default: 'null'
    },
    password: {
        type: String,
        required: true
    },
    avatar:{
        type: String,
        default: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD/4QBWRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAAEsAAAAAQAAASwAAAAB/+0ALFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAPHAFaAAMbJUccAQAAAgAEAP/hDW5odHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvADw/eHBhY2tldCBiZWdpbj0n77u/JyBpZD0nVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkJz8+Cjx4OnhtcG1ldGEgeG1sbnM6eD0nYWRvYmU6bnM6bWV0YS8nIHg6eG1wdGs9J0ltYWdlOjpFeGlmVG9vbCAxMS44OCc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp0aWZmPSdodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyc+CiAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICA8dGlmZjpYUmVzb2x1dGlvbj4zMDAvMTwvdGlmZjpYUmVzb2x1dGlvbj4KICA8dGlmZjpZUmVzb2x1dGlvbj4zMDAvMTwvdGlmZjpZUmVzb2x1dGlvbj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFN0b2NrIFBsYXRmb3JtPC94bXA6Q3JlYXRvclRvb2w+CiA8L3JkZjpEZXNjcmlwdGlvbj4KCiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogIHhtbG5zOnhtcE1NPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vJz4KICA8eG1wTU06RG9jdW1lbnRJRD54bXAuaWlkOjgyOTUzMjZkLTE1N2YtNDBjYi1hMTg1LWE0NTJlMTYyY2M5NjwveG1wTU06RG9jdW1lbnRJRD4KICA8eG1wTU06SW5zdGFuY2VJRD5hZG9iZTpkb2NpZDpzdG9jazpjNmI1ZmJjMS1kODg5LTQyZTAtOGNlYS02Y2YyMDgyOTNjY2U8L3htcE1NOkluc3RhbmNlSUQ+CiAgPHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD5hZG9iZTpkb2NpZDpzdG9jazozMzk0NTk2OTc8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KIDwvcmRmOkRlc2NyaXB0aW9uPgo8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSd3Jz8+/9sAQwAF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"
    },
    time: {
        type: String,
        default: `${currentDate.getDate()}/${currentDate.getMonth() + 1}/${currentDate.getFullYear()}`,
    }
});

modelUsers.pre('save', async function (next) {
    if (!this.isModified('password')) return next();  // Nếu mật khẩu chưa thay đổi, không mã hóa lại
    
    const salt = await bcrypt.genSalt(10);  // Tạo salt với mức độ bảo mật 10
    this.password = await bcrypt.hash(this.password, salt);  // Mã hóa mật khẩu với salt
    next();  // Tiến hành lưu người dùng
  });
  
  // Hàm so sánh mật khẩu trong khi đăng nhập
  modelUsers.methods.comparePassword = async function (password) {
    return await bcrypt.compare(password, this.password);  // So sánh mật khẩu đã mã hóa
  };
  

module.exports = mongoose.model('Users', modelUsers);
